<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>repl.it</title>
    <link href="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <style>
        :root {
            --mdc-theme-primary: navy;
        }
        body {
            margin: 0;
        }
        main {
            margin-left: 8px;
        }
        .view {
            display: none;
        }
        .template {
            display: none;
        }
		.mdc-data-table{
			visibility: hidden;
		}
			
		tr, th, td {
  			padding: 15px;
			text-align: center;
		}
		table {
			visibility: hidden;
		}
    </style>

</head>

<body>

    <header class="mdc-top-app-bar">
        <div class="mdc-top-app-bar__row">
            <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start">
                <span class="mdc-top-app-bar__title">Project 4 Coronavirus</span>
            </section>
            <section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end" role="toolbar">
                <button id="page1" class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Display Chart">bar_chart</button>
                <button id="page2" class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Display Table">grid_on</button>
                <button id="page3" class="material-icons mdc-top-app-bar__action-item mdc-icon-button" aria-label="Show Map">location_on</button>
            </section>
        </div>
    </header>



    <main class="description">
        <h1 style="font-family:sans-serif;">Hello and welcome.</h1>
		<p style="font-family:sans-serif;">Select and submit a maximum of five countries. Then hit the display button. (Confirmed Cases right now)</p>
		<p style="font-family:sans-serif;">You can use the buttons on the top right to show a data table, or a Google chart. (Confirmed Cases right now)</p>
		<p style="font-family:sans-serif;">This is the chart page.</p>

	
	<!-- Give items an id to query -->
        <input list="countries" id="countryContainer">
        <datalist id="countries">
            <option value="">
        </datalist>
		<input type="submit" id="Submit">
		
		        <div id="data">
            <!-- Incorrectly copied from MDC so added classes after mdc-list.. -->
            <ul class="mdc-list mdc-list--two-line mdc-list--avatar-list">
                <!-- Forgot to add "template" class. -->
                <li class="template mdc-list-item mdc-ripple-upgraded">
                    <span class="mdc-list-item__graphic material-icons" aria-hidden="true"></span>
                    <span class="mdc-list-item__text">
			<span class="mdc-list-item__primary-text"></span>
                    <span class="mdc-list-item__secondary-text"></span>
                    </span>
                </li>
			</ul>

        </div>
        <div>
            <button class="mdc-button">
                <div class="mdc-button__ripple" id="displayButton"></div>
                <span class="mdc-button__label">Display Total Cases</span>
            </button>
        </div>
	</main>


	

	
<table id="table">
  <tr id="Headers">
    <th>Date</th>
  </tr>
</table>

	
<canvas id="myChart" width="100" height="100"></canvas>


</body>

<script src="Chart.js"></script>
<script>
	
/*-------------------- FUNCTION SECTION --------------------*/
    function addData(chart, label, data) {
        chart.data.labels.push(label);
        chart.data.datasets.forEach((dataset) => {
            dataset.data.push(data);
        });
        chart.update();
    }

    function removeData(chart) {
        chart.data.labels.pop();
        chart.data.datasets.forEach((dataset) => {
            dataset.data.pop();
        });
        chart.update();
    }
	
    const displayData = (context, numbersArray, countriesArray) => {
        let myChart = new Chart(context, {
            type: 'bar',
            data: {
                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [{
                    label: 'Total Cases',
                    data: [12, 19, 3, 5, 2, 3],
                    backgroundColor: ['rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)', 'rgba(255, 206, 86, 0.2)', 'rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)', 'rgba(255, 159, 64, 0.2)'],
                    borderColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)'],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                }
            }
        });
        removeData(myChart);
        for(let i = 0; i < numbersArray.length; i++) {
            addData(myChart, countriesArray[i], numbersArray[i]);
        }
    }
	
	
	const buildTable = (countriesArray, numbersArray) => {
		// Build Table
		let H = document.querySelector(".mdc-data-table__header-cell--numeric").cloneNode(true);
	}
	
	
	/*-------------------- END FUNCTION SECTION --------------------*/
	
	/*-------------------- PAGE ONE --------------------*/
	/*-------------------- PAGE ONE --------------------*/
	
	// Declare variables.
    let canvas = document.querySelector('#myChart');
	
	let ctx = canvas.getContext('2d');
    let countryData;
    let countryList = [];
    let pageOneTotalCasesList = [];
    let pageOneTotalConfirmed = 0;

	let datesList = [];
	let daysCases = [];
	
	let length = 0;
    // Section to fill the list with countries.
    let apiEndPoint = "https://pomber.github.io/covid19/timeseries.json";
	
	let table = document.querySelector("#table");
	let welcomeText = document.querySelector(".description");

	
	/*-------------------- FETCH AND BUILD --------------------*/
    fetch(apiEndPoint).then(response => {
        return response.json()
    }).then(json => {
        // Turn countryData = json object.
        countryData = json;
        //             console.log(countryData);
        // Find the node that contains the list.
        let theList = document.querySelector("#countries");
        //             console.log(theList);
        // Iterate through the json object. 'item' = country name.
        for(item in countryData) {
            // Clone the item inside the list.
            let opcione = document.createElement('option');
            opcione.value = item;
            theList.appendChild(opcione);
        }
		
		let topRow = document.querySelector("#TopRow");
		let table = document.querySelector("#Tbl");
        // Build the list that displays on the page while growing the arrays needed to store data.
        // Event listener for submit button.
        let submitButton = document.querySelector("#Submit");
        submitButton.addEventListener("click", event => {
            let textBox = document.querySelector("#countryContainer");
            let chosenCountry = textBox.value;
            let chosenCountryDeaths = 0;
			
            if(chosenCountry != "") {
				length = countryData[chosenCountry].length;
				console.log("Length is " + length);
                // Clone template
                let clone = document.querySelector("div#data li.template").cloneNode(true);
                // Add country to array after checking if it is there or not.
                let boolean = countryList.includes(chosenCountry);
                if(!boolean) {
                    countryList.push(chosenCountry);
										
                    // Remove template class from clone.
                    // 
                    clone.classList.remove("template");
                    // Update the value
                    clone.querySelector(".mdc-list-item__primary-text").textContent = chosenCountry;
                    clone.querySelector(".mdc-list-item__secondary-text").textContent = chosenCountry + "'s most recent data.";
                    // Append to list.
                    document.querySelector("div#data ul.mdc-list").appendChild(clone);
                    for(item of countryData[chosenCountry]) {
                        pageOneTotalConfirmed = pageOneTotalConfirmed + item['confirmed'];
                    }
					
					
                    pageOneTotalCasesList.push(pageOneTotalConfirmed);
					

				}
            }
        })
		
	/*-------------------- DISPLAY CHART --------------------*/
        let displayButton = document.querySelector("#displayButton");
        displayButton.addEventListener("click", event => {
            console.log('display');
            console.log(pageOneTotalCasesList);
            displayData(canvas, pageOneTotalCasesList, countryList);
        })
    })
	/*-------------------- END PAGE ONE --------------------*/
	/*-------------------- END PAGE ONE --------------------*/

	
	/*-------------------- PAGE TWO --------------------*/
	/*-------------------- PAGE TWO --------------------*/
	

	/*-------------------- NAVIGATION --------------------*/
	
	let p1Button = document.querySelector("#page1");
	p1Button.addEventListener("click", event => { console.log("SO");})
	
	let p2Button = document.querySelector("#page2");
	p2Button.addEventListener("click", event => { 
		console.log("YOU");
		
		// Clear canvas and display the table.
		ctx.clearRect(0,0, canvas.width, canvas.width);
	 	welcomeText.style.visibility = "hidden";
		
		let header = document.querySelector("#Headers");
		for (country of countryList)
		{
			console.log(country);
			let newH = document.createElement("th");
			newH.textContent = country;
			header.appendChild(newH);
		}
		
		for(let i = 0; i < length; i++)
		{
			let newR = document.createElement("tr");
// 			console.log(countryData["Afghanistan"][i]['date']);
			let newTD = document.createElement("td");
			newTD.textContent = countryData["Afghanistan"][i]['date'];
			newR.appendChild(newTD);
			
		for(country of countryList)
		{
			console.log("country is " + country);
			console.log("country cases are " + countryData[country][i]['confirmed']);

			let otherTD = document.createElement("td");
			otherTD.textContent = countryData[country][i]['confirmed'];
			newR.appendChild(otherTD);
		}
			table.appendChild(newR);

		}
		
		// Show table
		table.style.visibility = "visible";

		
	})
	
	let p3Button = document.querySelector("#page3");
	p3Button.addEventListener("click", event => { console.log("WANNA BE A MILLIONAIRE");})

	
</script>

</html>