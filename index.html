<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>repl.it</title>
    <link href="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@v4.0.0/dist/material-components-web.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

    <style>
        :root {
            --mdc-theme-primary: navy;
        }
        body {
            margin: 0;
        }
        main {
            margin-left: 8px;
        }
        .view {
            display: none;
        }
        .template {
            display: none;
        }
    </style>

</head>

<body>
    <button class="mdc-button foo-button mdc-button--raised" id="GRAF">
        <div class="mdc-button__ripple"></div>
        <span class="mdc-button__label">Screen One </span>
    </button>
    <button class="mdc-button foo-button mdc-button--raised" id="SFD">
        <div class="mdc-button__ripple"></div>
        <span class="mdc-button__label">Screen Two </span>
    </button>
    <button class="mdc-button foo-button mdc-button--raised" id="CSF">
        <div class="mdc-button__ripple"></div>
        <span class="mdc-button__label">Screen Three</span>
    </button>
    <br>
    <h1> Select a maximum of five countries, and then select what you would like to display..</h1>

    <!-- Give items an id to query -->
    <input list="countries" id="countryContainer">
    <datalist id="countries">
        <option value="">
    </datalist>
    <input type="submit" id="Submit">


    <div id="data">
        <!-- Incorrectly copied from MDC so added classes after mdc-list.. -->
        <ul class="mdc-list mdc-list--two-line mdc-list--avatar-list">
            <!-- Forgot to add "template" class. -->
            <li class="template mdc-list-item mdc-ripple-upgraded">
                <span class="mdc-list-item__graphic material-icons" aria-hidden="true"></span>
                <span class="mdc-list-item__text">
			<span class="mdc-list-item__primary-text"></span>
                <span class="mdc-list-item__secondary-text"></span>
                </span>
            </li>

    </div>
		<div>
<button class="mdc-button">
  <div class="mdc-button__ripple" id="displayButton"></div>
  <span class="mdc-button__label">Display Total Cases</span>
</button>			
		</div>
			
<canvas id="myChart" width="100" height="100"></canvas>


</body>

<script src="Chart.js"></script>
<script>

	
	function addData(chart, label, data) {
    chart.data.labels.push(label);
    chart.data.datasets.forEach((dataset) => {
        dataset.data.push(data);
    });
    chart.update();
}

function removeData(chart) {
    chart.data.labels.pop();
    chart.data.datasets.forEach((dataset) => {
        dataset.data.pop();
    });
    chart.update();
}

	
	
	
	const displayData = (context, numbersArray, countriesArray) =>
	{
var myChart = new Chart(context, {
    type: 'bar',
    data: {
        labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
        datasets: [{
            label: 'Total Cases',
            data: [12, 19, 3, 5, 2, 3],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        }
    }
});
			removeData(myChart);
		for (let i = 0; i < numbersArray.length; i++)
		{
			addData(myChart, countriesArray[i], numbersArray[i]);
		}
	}
	
    let ctx = document.querySelector('#myChart');
    // Section to fill the list with countries.
    let apiEndPoint = "https://pomber.github.io/covid19/timeseries.json";
    let countryData;
	
		let countryList = [];
		
		let deathsList = [];
		
		let totalDeaths = 0;
		

    fetch(apiEndPoint).then(response => {
        return response.json()
    }).then(json => {
        // Turn countryData = json object.
        countryData = json;
        //             console.log(countryData);
        // Find the node that contains the list.
        let theList = document.querySelector("#countries");
        //             console.log(theList);
        // Iterate through the json object. 'item' = country name.
        for(item in countryData) {
            //                 console.log(item);
            // Clone the item inside the list.
            let opcione = document.createElement('option');
            opcione.value = item;
            theList.appendChild(opcione);
            // Second level to go into each country.
        }
		
        // Build the list.
//         let countryList = [];
		
// 		let deathsList = [];
		
// 		let totalDeaths = 0;
		


        // Event listener for submit button.
        let submitButton = document.querySelector("#Submit");
        submitButton.addEventListener("click", event => {
            let textBox = document.querySelector("#countryContainer");
            let chosenCountry = textBox.value;
            let chosenCountryDeaths = 0;
            if(chosenCountry != "") {
                // Clone template
                let clone = document.querySelector("div#data li.template").cloneNode(true);
                // Add country to array after checking if it is there or not.
                let boolean = countryList.includes(chosenCountry);
                if(!boolean) {
                    countryList.push(chosenCountry);
                    // Remove template class from clone.
                    // 
                    clone.classList.remove("template");
                    // Update the value
                    clone.querySelector(".mdc-list-item__primary-text").textContent = chosenCountry;
                    clone.querySelector(".mdc-list-item__secondary-text").textContent = chosenCountry + "'s most recent data.";
                    // Append to list.
                    document.querySelector("div#data ul.mdc-list").appendChild(clone);
					
					
					for (item of countryData[chosenCountry])
					{
						totalDeaths = totalDeaths + item['confirmed'];
						

					}
					deathsList.push(totalDeaths);
					
// 					console.log(countryList);
// 					console.log(deathsList);
                }
            } 
        })
		
		let displayButton = document.querySelector("#displayButton");
		displayButton.addEventListener("click", event =>{
			console.log('display');
			console.log(deathsList);
			displayData(ctx, deathsList, countryList);
		}
									  )
		

    })
//     let ctx = document.querySelector('#myChart');
			
</script>

</html>